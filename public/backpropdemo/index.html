<html>
  <head>
    <script>
      (()=>{"use strict";var e={421:(e,t)=>{function n(e,t,n){const r=[];for(let o=0;o<n;o++)r.push(Math.random()*(t-e)+e);return r}Object.defineProperty(t,"__esModule",{value:!0}),t.Net=void 0;class r{constructor({weights:e,biases:t,dimensions:n}){this.weights=e,this.biases=t,this.dimensions=n}static create(e,t,o,i){const s=n(-1,1,e*o),l=n(-1,1,o*t),a=[s,...new Array(i-1).fill(0).map((()=>n(-1,1,o*o))),l],d=n(-1,1,t),u=[...new Array(i).fill(0).map((()=>n(-1,1,o))),d],c=[e,...new Array(i).fill(o),t];return new r({weights:a,biases:u,dimensions:c})}static mergeGradients(e){const[t,n]=e[0];for(let r=1;r<e.length;r++)for(let o=0;o<t.length;o++){for(let n=0;n<t[o].length;n++)t[o][n]+=e[r][0][o][n];if(!(o>=t.length-1))for(let t=0;t<n[o].length;t++)n[o][t]+=e[r][1][o][t]}for(let r=0;r<t.length;r++){for(let n=0;n<t[r].length;n++)t[r][n]/=e.length;if(!(r>=t.length-1))for(let t=0;t<n[r].length;t++)n[r][t]/=e.length}return[t,n]}eval(e){if(e.length!==this.dimensions[0])throw new Error(`Input size ${e.length} does not match net input size ${this.dimensions[0]}`);const t=[e];for(let e=0;e<this.dimensions.length-1;e++){const n=t[e],r=[...this.biases[e]],o=this.weights[e];let i=0;for(let t=0;t<this.dimensions[e];t++)for(let s=0;s<this.dimensions[e+1];s++)r[s]+=n[t]*o[i],i++;t[e+1]=[];for(let n=0;n<r.length;n++)t[e+1][n]=1/(1+Math.exp(-r[n]))}return t}gradient(e,t){const n=this.eval(e).reverse(),r=[...this.weights].reverse(),o=[...this.dimensions].reverse(),i=[],s=[],l=[];for(let e=0;e<o[0];e++)l.push(n[0][e]*(1-n[0][e])*(n[0][e]-t[e]));i.push(l);for(let e=1;e<o.length;e++){const t=i[e-1],l=[],a=[];let d=0;for(let i=0;i<o[e];i++){let s=0;for(let l=0;l<o[e-1];l++)s+=r[e-1][d]*t[l],d++,a.push(t[l]*n[e][i]);l.push(s*(1-n[e][i])*n[e][i])}i.push(l),s.push(a)}return[i.reverse(),s.reverse()]}apply([e,t],n=.01,r=.01){for(let o=1;o<e.length;o++){for(let t=0;t<e[o].length;t++)this.biases[o-1][t]-=e[o][t]*r;for(let e=0;e<this.weights[o-1].length;e++)this.weights[o-1][e]-=t[o-1][e]*n}}error(e,t){const n=this.eval(e)[this.dimensions.length-1];return n.reduce(((e,n,r)=>e+Math.pow(n-t[r],2)),0)*(1/n.length)}errorDataset(e){let t=0;for(let n=0;n<e.length;n++)t+=this.error(...e[n]);return t/e.length}debug(){console.log("Weights: "),console.log(this.weights.map((e=>e.toString())).join("\n")),console.log("Biases: "),console.log(this.biases.map((e=>e.toString())).join("\n"))}train(e,t,n){var o,i,s,l;const a=null!==(o=null==n?void 0:n.gamma)&&void 0!==o?o:.2,d=null!==(i=null==n?void 0:n.gamma_b)&&void 0!==i?i:.2,u=null!==(s=null==n?void 0:n.momentum)&&void 0!==s?s:.5,c=null!==(l=null==n?void 0:n.batchSize)&&void 0!==l?l:1;let h=[[],[]],g=!0;for(let n=0;n<t;n++){let t=0;for(;t<e.length;){const n=e.slice(t,t+c).map((e=>this.gradient(...e))),o=r.mergeGradients(n);h=o,this.apply(o,a,d),g||this.apply(h,a*u,d*u),g=!1,t+=c}}}}t.Net=r},312:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Net=void 0;const r=n(421);Object.defineProperty(t,"Net",{enumerable:!0,get:function(){return r.Net}})},348:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBiasNeuron=void 0,t.drawBiasNeuron=function(e,t,n){e.fillStyle="#FCFF76",e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.arc(t,n,40,0,2*Math.PI),e.fill(),e.stroke(),e.fillStyle="black",e.font="bold 24px Arial",e.textAlign="center",e.fillText("BIAS",t,n+8)}},971:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawNeuron=void 0;const r=n(131);t.drawNeuron=function(e,t,n,o){e.fillStyle=(0,r.colorScale)(o),e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.arc(t,n,40,0,2*Math.PI),e.fill(),e.stroke(),e.fillStyle="white",e.font="bold 24px Arial",e.textAlign="center",e.fillText(o.toFixed(3),t,n+8)}},772:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawScene=void 0;const r=n(348),o=n(971),i=n(223);t.drawScene=function(e,t,n,s){e.clearRect(0,0,360,400),(0,i.drawWeight)(e,40,90,180,40,n[0][0]),(0,i.drawWeight)(e,40,90,180,140,n[0][1]),(0,i.drawWeight)(e,40,90,180,240,n[0][2]),(0,i.drawWeight)(e,40,190,180,40,n[0][3]),(0,i.drawWeight)(e,40,190,180,140,n[0][4]),(0,i.drawWeight)(e,40,190,180,240,n[0][5]),(0,i.drawWeight)(e,180,40,320,140,n[1][0]),(0,i.drawWeight)(e,180,140,320,140,n[1][1]),(0,i.drawWeight)(e,180,240,320,140,n[1][2]),(0,i.drawWeight)(e,40,360,180,40,s[0][0]),(0,i.drawWeight)(e,40,360,180,140,s[0][1]),(0,i.drawWeight)(e,40,360,180,240,s[0][2]),(0,i.drawWeight)(e,180,360,320,140,s[1][0]),(0,o.drawNeuron)(e,40,90,t[0][0]),(0,o.drawNeuron)(e,40,190,t[0][1]),(0,o.drawNeuron)(e,180,40,t[1][0]),(0,o.drawNeuron)(e,180,140,t[1][1]),(0,o.drawNeuron)(e,180,240,t[1][2]),(0,o.drawNeuron)(e,320,140,t[2][0]),(0,r.drawBiasNeuron)(e,40,360),(0,r.drawBiasNeuron)(e,180,360)}},223:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawWeight=void 0;const r=n(131);t.drawWeight=function(e,t,n,o,i,s){e.strokeStyle=(0,r.colorScale)(s),e.lineWidth=4,e.beginPath(),e.moveTo(t,n),e.lineTo(o,i),e.stroke()}},0:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCanvasObjects=void 0,t.getCanvasObjects=function(){const e=document.getElementById("nns-canvas"),t=e.getContext("2d");return[e,t]}},856:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNetOverallError=void 0;const r=n(195);t.getNetOverallError=function(e){return e.errorDataset(r.xorTest)}},416:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNetResults=void 0;const r=n(195);t.getNetResults=function(e){const t=[];for(const n of r.xorTest)t.push(e.eval(n[0])[2][0]);return t}},933:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.newNet=void 0;const r=n(312);t.newNet=function(){return r.Net.create(2,1,3,1)}},936:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trainConfig=void 0,t.trainConfig={gamma:.2,gamma_b:.2,momentum:.1,batchSize:1}},195:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.xorTest=void 0,t.xorTest=[[[1,0],[1]],[[0,1],[1]],[[0,0],[0]],[[1,1],[0]]]},615:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Simulation=void 0;const r=n(195),o=n(933),i=n(772),s=n(322),l=n(856),a=n(676),d=n(416),u=n(936);t.Simulation=class{constructor(e){this.currentDisplayCase=0,this.net=(0,o.newNet)(),this.autoSpeed="1",this.autoEnabled=!1,this.epoch=0,this.interval=setInterval((()=>null),1e5),this.ctx=e}update(){const{ctx:e,net:t,currentDisplayCase:n}=this,o=r.xorTest[n][0];(0,i.drawScene)(e,t.eval(o),t.weights,t.biases),(0,s.updateEpochErrorPanel)(this.epoch,(0,l.getNetOverallError)(t)),(0,a.updateResultsPanel)((0,d.getNetResults)(t))}train(e){this.net.train(r.xorTest,e,u.trainConfig),this.epoch+=e}setAutoSpeed(e){if(this.autoSpeed=e,!this.autoEnabled)return;let t=0;switch(e){case"1":t=500;break;case"10":t=50;break;case"max":t=0}clearInterval(this.interval),this.interval=setInterval((()=>{this.train(1),this.update()}),t)}startAuto(){this.autoEnabled=!0,this.setAutoSpeed(this.autoSpeed)}stopAuto(){clearInterval(this.interval),this.autoEnabled=!1}nextDisplayCase(){this.currentDisplayCase=(this.currentDisplayCase+1)%r.xorTest.length,this.update()}reset(){this.net=(0,o.newNet)(),this.epoch=0,this.update()}}},131:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.colorScale=void 0,t.colorScale=function(e){return e<0?`rgb(0, 0, ${Math.floor(255*Math.abs(1.2*e))})`:e>0?`rgb(${Math.floor(1.2*e*255)}, 0, 0)`:"rgb(0, 0, 0)"}},12:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatNum=void 0,t.formatNum=function(e){return e%1==0&&e<1e4?e.toString():e>-10&&e<10?e.toFixed(3):e>1e4?e.toExponential(3):e.toPrecision(6)}},973:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ready=void 0,t.ready=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}},322:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateEpochErrorPanel=void 0;const r=n(12);t.updateEpochErrorPanel=function(e,t){document.getElementById("epoch-count-number").innerHTML=(0,r.formatNum)(e),document.getElementById("epoch-error-number").innerHTML=(0,r.formatNum)(t)}},676:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateResultsPanel=void 0;const r=n(12);t.updateResultsPanel=function(e){document.getElementById("result-10").innerHTML=(0,r.formatNum)(e[0]),document.getElementById("result-01").innerHTML=(0,r.formatNum)(e[1]),document.getElementById("result-00").innerHTML=(0,r.formatNum)(e[2]),document.getElementById("result-11").innerHTML=(0,r.formatNum)(e[3])}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(()=>{const e=n(0),t=n(615);(0,n(973).ready)((()=>{const[n,r]=(0,e.getCanvasObjects)();n.width=360,n.height=400;const o=new t.Simulation(r);o.update();const i=["1","5","10","100"],s=[1,5,10,100];for(let e=0;e<i.length;e++){const t=`btn-step-plus${i[e]}`,n=document.getElementById(t);n?.addEventListener("click",(()=>{o.train(s[e]),o.update()}))}const l=["1x","10x","max"],a=["1","10","max"];for(let e=0;e<l.length;e++){const t=`btn-auto-${l[e]}`,n=document.getElementById(t);n?.addEventListener("click",(()=>{o.setAutoSpeed(a[e]),o.startAuto()}))}const d=document.getElementById("btn-auto-stop");d?.addEventListener("click",(()=>{o.stopAuto()}));const u=document.getElementById("btn-nextcase");u?.addEventListener("click",(()=>{o.nextDisplayCase()}));const c=document.getElementById("btn-reset");c?.addEventListener("click",(()=>{o.reset()}))}))})()})();
    </script>
    <style>
      div {
        background-color: white;
        border: 1px solid black;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        padding: 0px;
        margin: 0px;
      }

      p {
        font-weight: bold;
        color: black;
        text-align: center;
        font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
          "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
        padding: 0px;
        margin: 0px;
      }

      th,
      td {
        font-weight: bold;
        color: black;
        text-align: center;
        font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
          "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
        padding: 0px;
        margin: 0px;
        border: 1px solid black;
        box-sizing: border-box;
      }

      table {
        padding: 0px;
        margin: 0px;
        border-collapse: collapse;
        table-layout: fixed;
        box-sizing: border-box;
      }

      #nns-frame {
        width: 600px;
        height: 460px;
        position: relative;
      }

      #nns-title {
        width: 600px;
        height: 60px;
        position: absolute;
        top: 0px;
        left: 0px;
      }

      #nns-title p {
        width: 598px;
        height: 34px;
        position: absolute;
        top: 13px;
        font-size: 32px;
      }

      #visualization-frame {
        width: 360px;
        height: 400px;
        position: absolute;
        top: 60px;
        left: 0px;
      }

      #nns-canvas {
        width: 360px;
        height: 400px;
      }

      #control-frame {
        width: 240px;
        height: 400px;
        position: absolute;
        top: 60px;
        right: 0px;
      }

      #epoch-error-display {
        width: 240px;
        height: 72px;
      }

      #epoch-error-display table {
        width: 240px;
        height: 72px;
        font-size: 24px;
      }

      #epoch-error-display thead,
      #epoch-error-display tbody {
        display: inline-block;
        box-sizing: border-box;
        width: 238px;
        height: 36px;
      }

      #epoch-error-display th,
      #epoch-error-display td {
        width: 120px;
        height: 36px;
      }

      #model-results-display {
        width: 240px;
        height: 144px;
      }

      #model-results-display p {
        width: 240px;
        height: 24px;
        font-size: 24px;
      }

      #model-results-display table {
        width: 240px;
        height: 120px;
      }

      #model-results-display th,
      #model-results-display td {
        width: calc(238px / 3);
        height: 24px;
      }

      #model-results-display thead,
      #model-results-display tbody {
        display: inline-block;
        box-sizing: border-box;
        width: 238px;
        height: 24px;
      }

      #sim-control-panel {
        width: 240px;
        height: 184px;
      }

      #sim-control-title {
        width: 240px;
        height: 24px;
        font-size: 24px;
      }

      #sim-control-subheading {
        width: 240px;
        height: 18px;
        font-size: 18px;
      }

      .control-group {
        color: white;
        display: grid;
        grid-template-columns: auto auto auto auto;
        justify-content: space-evenly;
        border: none;
      }

      .control-group-duo {
        color: white;
        display: grid;
        grid-template-columns: auto auto;
        justify-content: space-evenly;
        border: none;
      }

      .control-button {
        background-color: #40ff5e;
        font-size: 20px;
        border-radius: 5px;
        width: 56px;
        height: 30px;
        display: inline-block;
        border: none;
        cursor: pointer;
      }

      .control-button-duo {
        background-color: #40ff5e;
        font-size: 20px;
        border-radius: 5px;
        width: 116px;
        height: 30px;
        display: inline-block;
        border: none;
        cursor: pointer;
      }

      .control-button p,
      .control-button-duo p {
        border-radius: 5px;
        width: 100%;
        color: white;
        height: 24px;
        margin-top: 3px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      .red {
        background-color: #ff0000;
      }
    </style>
  </head>
  <body>
    <div id="nns-frame">
      <div id="nns-title">
        <p>Neural Net Simulator (XOR Test)</p>
      </div>
      <div id="visualization-frame">
        <canvas id="nns-canvas"></canvas>
      </div>
      <div id="control-frame">
        <div id="epoch-error-display">
          <table>
            <thead>
              <tr>
                <th>Epoch</th>
                <th>Error</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="epoch-count-number">0</td>
                <td id="epoch-error-number">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="model-results-display">
          <p>Model Results</p>
          <table>
            <thead>
              <tr>
                <th>Input</th>
                <th>Expected</th>
                <th>Actual</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1,0</td>
                <td>1</td>
                <td id="result-10">0</td>
              </tr>
              <tr>
                <td>0,1</td>
                <td>1</td>
                <td id="result-01">0</td>
              </tr>
              <tr>
                <td>0,0</td>
                <td>0</td>
                <td id="result-00">0</td>
              </tr>
              <tr>
                <td>1,1</td>
                <td>0</td>
                <td id="result-11">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="sim-control-panel">
          <p id="sim-control-title">Sim Control</p>

          <p id="sim-control-subheading">Step</p>
          <div class="control-group">
            <div class="control-button" id="btn-step-plus1">
              <p>+1</p>
            </div>
            <div class="control-button" id="btn-step-plus5">
              <p>+5</p>
            </div>
            <div class="control-button" id="btn-step-plus10">
              <p>+10</p>
            </div>
            <div class="control-button" id="btn-step-plus100">
              <p>+100</p>
            </div>
          </div>
          <p id="sim-control-subheading">Auto</p>
          <div class="control-group">
            <div class="control-button" id="btn-auto-1x">
              <p>1x</p>
            </div>
            <div class="control-button" id="btn-auto-10x">
              <p>10x</p>
            </div>
            <div class="control-button" id="btn-auto-max">
              <p>MAX</p>
            </div>
            <div class="control-button red" id="btn-auto-stop">
              <p>STOP</p>
            </div>
          </div>
          <p id="sim-control-subheading">General</p>
          <div class="control-group-duo">
            <div class="control-button-duo" id="btn-nextcase">
              <p>NEXT CASE</p>
            </div>
            <div class="control-button-duo red" id="btn-reset">
              <p>RESET</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
